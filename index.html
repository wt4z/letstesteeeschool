<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Bullis School – Potomac</title>
<style>
body{font-family:Arial,sans-serif;margin:0;background:#f4f7fb}
header{background:#002F6C;color:#FFC726;padding:20px;text-align:center}
nav{background:#e2e8f0;padding:10px;display:flex;justify-content:center;gap:20px}
nav a{text-decoration:none;color:#002F6C;font-weight:bold}
main{padding:20px;max-width:900px;margin:auto}
section{background:#fff;padding:15px;margin-bottom:15px;border-radius:8px;box-shadow:0 2px 5px rgba(0,0,0,0.1)}
h2{color:#002F6C}
footer{background:#002F6C;color:#FFC726;text-align:center;padding:15px}
img.logo{height:50px;vertical-align:middle;margin-right:10px}

/* Hotspot & login box */
#hotspot{position:fixed;bottom:10px;right:10px;width:40px;height:40px;background:transparent;cursor:pointer;z-index:1000}
#passwordBox{position:fixed;bottom:60px;right:10px;display:none;z-index:1001;background:#fff;border:2px solid #002F6C;border-radius:8px;padding:10px;box-shadow:0 2px 6px rgba(0,0,0,.15);width:300px}
#passwordBox input{display:block;margin-bottom:6px;padding:8px;font-size:14px;border:1px solid #ccc;border-radius:4px;width:100%;box-sizing:border-box}
#passwordBox button{padding:8px;font-size:14px;background:#002F6C;color:#FFC726;border:none;border-radius:4px;cursor:pointer;width:100%}
#errorText{color:#c0392b;font-size:13px;margin-top:6px;display:none}

/* Embed container */
#embedContainer{display:none;margin-top:20px;width:100%;height:500px}

/* Admin panel */
#adminPanel{display:none;padding:12px;background:#fff;border-radius:8px;border:2px solid #002F6C;box-shadow:0 2px 6px rgba(0,0,0,.12);margin-top:20px}
.acct{display:flex;align-items:center;justify-content:space-between;border:1px solid #e6eef9;padding:8px;border-radius:6px;margin-bottom:8px;background:#f8fbff}
.acct .meta{font-size:14px;color:#08304a}
.revealBtn{background:#002F6C;color:#FFC726;border:none;padding:6px 8px;border-radius:6px;cursor:pointer}
.small{font-size:13px;color:#485b6b}
</style>
</head>
<body>

<header>
  <img src="https://resources.finalsite.net/images/f_auto,q_auto,t_image_size_1/v1721670094/bullis/vbqhybisnzf52q6lwhbd/SecondaryBulldogFullColor.png" alt="Bulldog Logo" class="logo">
  <span>Bullis School – Potomac, MD</span>
  <p>“Caring • Challenging • Community”</p>
</header>

<nav>
  <a href="#">Home</a>
  <a href="#">About</a>
  <a href="#">Students</a>
  <a href="#">Faculty & Staff</a>
  <a href="#">Contact</a>
</nav>

<main>
  <section>
    <h2>Announcements</h2>
    <ul>
      <li>Welcome back Week begins Monday at 8 a.m.</li>
      <li>Bulldog Spirit Day next Friday – wear blue & gold!</li>
      <li>Library opens extended hours during finals week.</li>
    </ul>
  </section>

  <section>
    <h2>Upcoming Events</h2>
    <ul>
      <li>Varsity Football: Saturday at 1 p.m. at Kline Stadium</li>
      <li>Upper School Science Expo: Next Tuesday, 5–7 p.m.</li>
      <li>Drama Production: “The Taming of the Shrew” – Thursday, 7 p.m.</li>
    </ul>
  </section>

  <section>
    <h2>Resources</h2>
    <p>Access your schedules, class links, and our Bulldog community portal. Stay connected, stay inspired.</p>
  </section>

  <div id="adminPanel" aria-hidden="true"></div>

  <div id="embedContainer">
    <iframe src="https://myappsclasslink.pegle.com" width="100%" height="100%" style="border:0"></iframe>
  </div>
</main>

<div id="hotspot" title="secret"></div>

<div id="passwordBox"></div>

<footer>
  &copy; 2025 Bullis School • 10601 Falls Rd, Potomac, MD 20854
</footer>

<script>
/* ----- CONFIG ----- */
const validUsers = [
  {username:"admin",password:"letmein",expires:"2026-01-01T00:00:00Z",isAdmin:true},
  {username:"staff1",password:"bulldog2025",expires:"2025-01-01T00:00:00Z",isAdmin:false}, // copy this when adding new
  {username:"teacher",password:"opensesame",expires:"2025-11-15T23:59:59Z",isAdmin:false}  // y/m/d
];

const BANS = [
  {username:"baduser",reason:"Suspicious activity"},
  {ip:"123.45.67.89",reason:"Blocked IP due to abuse"}
];

/* Fetch public IP */
let clientIP = null;
async function fetchIP(){
  if(clientIP) return clientIP;
  try{const r=await fetch("https://api.ipify.org?format=json",{cache:"no-store"});const j=await r.json();clientIP=j.ip||"unknown"}catch(e){clientIP="unknown"}
  return clientIP;
}

/* Login box click */
document.getElementById('hotspot').addEventListener('click',()=>{
  const pw = document.getElementById('passwordBox');
  pw.innerHTML = `
    <input id="loginUser" type="text" placeholder="Username" autocomplete="username" />
    <input id="loginPass" type="password" placeholder="Password" autocomplete="current-password" />
    <button id="loginBtn">→</button>
    <div id="errorText"></div>
    <div class="small" style="margin-top:8px">Tip: admin can manage bans.</div>
  `;
  pw.style.display='block';
  document.getElementById('loginUser').focus();
  document.getElementById('loginBtn').addEventListener('click', onLoginClick);
});

/* Navigate or replace (fallback if iframe) */
function navigateOrReplace(url, fallbackHtml){
  try{if(top&&top.location){top.location.href=url;return}}catch(e){}
  document.documentElement.innerHTML=fallbackHtml;
  try{window.stop()}catch(e){}
}

/* Ban page fallback */
function banFallbackHtml(ip,reason){
  return `<div style="font-family:Arial,Helvetica,sans-serif;display:flex;min-height:100vh;align-items:center;justify-content:center;background:#0d1220;color:#fff;margin:0;padding:32px">
    <div style="max-width:720px;background:#091028;padding:28px;border-radius:10px;box-shadow:0 8px 30px rgba(0,0,0,.6);text-align:center">
      <h1 style="color:#ffb86b;margin:0 0 8px">Access Restricted</h1>
      <p style="color:#dbe7ff;margin:0 0 12px">${reason}</p>
      <p style="color:#dbe7ff;margin:0 0 12px"><strong>Reference IP:</strong> ${ip}</p>
      <small style="color:#9fb0d6;display:block;margin-top:8px">If this is an error, contact <a href="mailto:admin@bullis.edu" style="color:#ffc726">admin@bullis.edu</a>.</small>
    </div>
  </div>`;
}

/* Expired page fallback */
function expiredFallbackHtml(ip){
  return `<div style="font-family:Arial,Helvetica,sans-serif;display:flex;min-height:100vh;align-items:center;justify-content:center;background:#f4f7fb;margin:0;padding:32px">
    <div style="max-width:720px;background:#fff;padding:28px;border-radius:10px;box-shadow:0 8px 30px rgba(0,0,0,.06);text-align:center">
      <h1 style="color:#e69100;margin:0 0 8px">Account Expired</h1>
      <p style="color:#333;margin:0 0 12px">Your account license has expired. Please contact administration.</p>
      <p style="color:#333;margin:0 0 12px"><strong>Reference IP:</strong> ${ip}</p>
    </div>
  </div>`;
}

/* Login handler */
async function onLoginClick(){
  const user=document.getElementById('loginUser').value.trim();
  const pass=document.getElementById('loginPass').value.trim();
  const errEl=document.getElementById('errorText');
  errEl.style.display='none';
  const ip = await fetchIP();
  const now = new Date();

  // Check bans
  const banEntry = BANS.find(b=>(b.username && b.username===user) || (b.ip && b.ip===ip));
  if(banEntry){ navigateOrReplace('ban.html', banFallbackHtml(ip, banEntry.reason)); return; }

  // Check account
  const account = validUsers.find(a=>a.username===user);
  if(!account || account.password!==pass){ errEl.textContent="Invalid username or password."; errEl.style.display='block'; return; }
  if(new Date(account.expires)<=now){ navigateOrReplace('expired.html', expiredFallbackHtml(ip)); return; }

  // Success
  document.getElementById('passwordBox').style.display='none';
  if(account.isAdmin) showAdminPanel(); else document.getElementById('embedContainer').style.display='block';
}

/* Admin panel */
function showAdminPanel(){
  const panel=document.getElementById('adminPanel');
  panel.innerHTML=''; panel.style.display='block'; panel.setAttribute('aria-hidden','false');
  const title=document.createElement('div');
  title.innerHTML='<h3 style="margin:0 0 8px;color:#002F6C">Admin Console — Valid Accounts</h3>';
  panel.appendChild(title);
  validUsers.forEach(acc=>{
    const el=document.createElement('div'); el.className='acct';
    const expiry=new Date(acc.expires); const msLeft=expiry-Date.now(); const human=msLeft>0?Math.floor(msLeft/(1000*60*60))+' hours left':'expired';
    const meta=document.createElement('div'); meta.className='meta'; meta.innerHTML=`<strong>${acc.username}</strong> <div class="small">${human}</div>`;
    const btn=document.createElement('button'); btn.className='revealBtn'; btn.textContent='View';
    btn.addEventListener('click',()=>{ const existing=el.querySelector('.revealBox'); if(existing){existing.remove(); return;} const box=document.createElement('div'); box.className='revealBox'; box.style.marginTop='8px'; box.style.padding='8px'; box.style.background='#fff'; box.style.border='1px solid #dde9fb'; box.style.borderRadius='6px'; box.innerHTML=`<div style="font-size:13px;color:#08304a">Username: <strong>${acc.username}</strong></div><div style="font-size:13px;color:#08304a;margin-top:6px">Password: <strong>${acc.password}</strong></div><div style="font-size:12px;color:#485b6b;margin-top:6px">Expires: ${acc.expires}</div>`; el.appendChild(box); });
    el.appendChild(meta); el.appendChild(btn); panel.appendChild(el);
  });
}
</script>
</body>
</html>
