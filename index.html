<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Bullis School ‚Äì Potomac</title>
<style>
:root {
  --gold:#FFC726;
  --notif-bg:rgba(44,44,44,0.92);
}
body {font-family:Arial,sans-serif;margin:0;background:#f4f7fb;color:#08304a}
header {background:#002F6C;color:var(--gold);padding:20px;text-align:center}
nav {background:#e2e8f0;padding:10px;display:flex;justify-content:center;gap:20px}
nav a {text-decoration:none;color:#002F6C;font-weight:bold}
main {padding:20px;max-width:900px;margin:auto}
section {background:#fff;padding:15px;margin-bottom:15px;border-radius:8px;box-shadow:0 2px 5px rgba(0,0,0,.1)}
h2 {color:#002F6C}
footer {background:#002F6C;color:var(--gold);text-align:center;padding:15px}
img.logo {height:50px;vertical-align:middle;margin-right:10px}

/* secret login hotspot */
#hotspot {
  position:fixed;bottom:10px;right:10px;width:40px;height:40px;background:transparent;cursor:pointer;z-index:1200
}
#passwordBox {
  position:fixed;bottom:60px;right:10px;display:none;z-index:1201;background:#fff;
  border:2px solid #002F6C;border-radius:8px;padding:10px;box-shadow:0 2px 6px rgba(0,0,0,.15);
  width:320px
}
#passwordBox input {display:block;margin-bottom:6px;padding:8px;font-size:14px;border:1px solid #ccc;border-radius:4px;width:100%}
#passwordBox button {
  padding:8px;font-size:14px;background:#002F6C;color:var(--gold);
  border:none;border-radius:4px;cursor:pointer;width:100%
}

/* admin panel + announcements */
#adminPanel {display:none;padding:12px;background:#fff;border-radius:8px;border:2px solid #002F6C;
  box-shadow:0 2px 6px rgba(0,0,0,.12);margin-top:20px}
.acct {display:flex;align-items:center;justify-content:space-between;border:1px solid #e6eef9;
  padding:8px;border-radius:6px;margin-bottom:8px;background:#f8fbff}
.revealBtn {background:#002F6C;color:var(--gold);border:none;padding:6px 8px;border-radius:6px;cursor:pointer}
.badge {display:inline-block;padding:2px 6px;font-size:11px;font-weight:bold;border-radius:4px;margin-left:6px;color:#fff}
.badge.owner{background:#d6336c}
.badge.admin{background:#0052cc}
.badge.contributor{background:#22863a}
.badge.forever{background:#ffb800;color:#000}

/* embed area */
#embedArea {display:none;margin-top:15px;background:#fff;padding:12px;border-radius:8px;border:1px solid #e6eef9;box-shadow:0 2px 6px rgba(0,0,0,.06)}
#embedArea .embedHeader {display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
#embedArea iframe {width:100%;height:600px;border-radius:8px;border:1px solid #e6eef9;display:block}
#embedArea .fallback {font-size:13px;margin-top:8px}

/* glass command bar */
#cmdOverlay {
  position:fixed;left:50%;transform:translateX(-50%);bottom:22%;width:88%;max-width:900px;
  z-index:1300;display:none;justify-content:center;align-items:center;pointer-events:auto
}
#cmdPanel {
  width:100%;border-radius:12px;padding:14px 16px;box-shadow:0 12px 30px rgba(0,0,0,0.4);
  border:1px solid rgba(255,199,38,0.25);
  background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.12));
  backdrop-filter: blur(8px);display:flex;gap:12px;align-items:center
}
#cmdInput {
  flex:1;background:rgba(255,255,255,0.03);border:none;outline:none;color:var(--gold);
  padding:10px 12px;border-radius:8px;font-size:15px;
  box-shadow:inset 0 0 0 1px rgba(255,255,255,0.02)
}
#cmdSubmit {
  background:transparent;border:1px solid rgba(255,199,38,0.18);
  color:var(--gold);padding:8px 12px;border-radius:8px;cursor:pointer;font-weight:bold
}

/* notifications */
#notifArea {
  position:fixed;left:18px;bottom:18px;z-index:1400;display:flex;flex-direction:column-reverse;
  gap:10px;max-width:360px
}
.notif {
  background:var(--notif-bg);color:#fff;padding:12px 14px;border-radius:10px;
  box-shadow:0 8px 20px rgba(0,0,0,0.45);
  border:1px solid rgba(255,199,38,0.12);
  display:flex;gap:10px;align-items:flex-start;min-width:220px;position:relative
}
.notif strong{color:var(--gold)}
.notif .closeBtn{
  position:absolute;right:8px;top:6px;background:transparent;border:none;
  color:#fff;font-weight:bold;cursor:pointer;font-size:14px
}
#clearAllBtn {
  display:none;align-self:flex-start;padding:6px 10px;border-radius:8px;
  border:1px solid rgba(255,199,38,0.18);background:transparent;
  color:var(--gold);cursor:pointer;margin-bottom:6px
}
</style>
</head>

<body>
<header>
  <img src="https://resources.finalsite.net/images/f_auto,q_auto,t_image_size_1/v1721670094/bullis/vbqhybisnzf52q6lwhbd/SecondaryBulldogFullColor.png" class="logo">
  <span>Bullis School ‚Äì Potomac, MD</span>
  <p>‚ÄúCaring ‚Ä¢ Challenging ‚Ä¢ Community‚Äù</p>
</header>

<nav>
  <a href="#">Home</a><a href="#">About</a><a href="#">Students</a>
  <a href="#">Faculty & Staff</a><a href="#">Contact</a>
</nav>

<main>
  <section id="announcementsSection" style="display:none;">
    <h2>Announcements</h2>
    <ul id="announcementsList"><li>Loading announcements...</li></ul>
  </section>
  <section>
    <h2>Upcoming Events</h2>
    <ul>
      <li>Varsity Football: Saturday at 1 p.m. at Kline Stadium</li>
      <li>Upper School Science Expo: Next Tuesday, 5‚Äì7 p.m.</li>
      <li>Drama Production: ‚ÄúThe Taming of the Shrew‚Äù ‚Äì Thursday, 7 p.m.</li>
    </ul>
  </section>
  <section>
    <h2>Resources</h2>
    <p>Access your schedules, class links, and our Bulldog community portal. Stay connected, stay inspired.</p>
  </section>

  <!-- Embed area: becomes visible after successful login -->
  <div id="embedArea" aria-live="polite"></div>

  <div id="adminPanel"></div>
</main>

<div id="hotspot" title="secret"></div>
<div id="passwordBox"></div>
<div id="cmdOverlay">
  <div id="cmdPanel">
    <input id="cmdInput" placeholder="Type command (help ‚Üí list commands)" autocomplete="off">
    <button id="cmdSubmit">Run</button>
  </div>
</div>

<div id="notifArea">
  <button id="clearAllBtn">Clear All</button>
</div>

<footer>¬© 2025 Bullis School ‚Ä¢ 10601 Falls Rd, Potomac, MD 20854</footer>

<script>
const validUsers = [
  {username:"owner", password:"1234", role:"Owner", isAdmin:true, expires:"never", notes:"Full access"},
  {username:"admin", password:"abcd", role:"Admin", isAdmin:true, expires:"never", notes:"Manages site"},
  {username:"teacher", password:"pass1", role:"Contributor", isAdmin:false, expires:"2025-12-30", notes:"Faculty"},
  {username:"student", password:"4321", role:"Student", isAdmin:false, expires:"2025-12-01", notes:"Regular user"}
];

const NOTIF_TIMEOUT_MS = 30000;
let currentUser = null;

function createNotification(title,message,opts={}) {
  const n = document.createElement("div");
  n.className="notif";
  n.innerHTML=`<div><strong>${title}</strong><div class="meta">${message}</div></div>`;
  const x=document.createElement("button");
  x.className="closeBtn";x.innerText="‚úï";
  x.onclick=()=>{n.remove();updateClearBtn();};
  n.appendChild(x);
  document.getElementById("notifArea").appendChild(n);
  updateClearBtn();
  if(!opts.sticky) setTimeout(()=>{n.remove();updateClearBtn();}, opts.timeoutMs||NOTIF_TIMEOUT_MS);
}
function updateClearBtn(){
  document.getElementById("clearAllBtn").style.display =
    document.querySelectorAll("#notifArea .notif").length>1?"inline-block":"none";
}
document.getElementById("clearAllBtn").onclick=()=>{
  document.querySelectorAll("#notifArea .notif").forEach(e=>e.remove());
  updateClearBtn();
};

// login
document.getElementById("hotspot").addEventListener("click",()=>{
  const box=document.getElementById("passwordBox");
  box.innerHTML=`
    <input id="loginUser" placeholder="Username">
    <input id="loginPass" type="password" placeholder="Password">
    <button id="loginBtn">‚Üí</button>`;
  box.style.display="block";
  document.getElementById("loginBtn").onclick=onLoginClick;
});

function onLoginClick(){
  const u=document.getElementById("loginUser").value.trim();
  const p=document.getElementById("loginPass").value.trim();
  const acc=validUsers.find(a=>a.username===u && a.password===p);
  if(!acc){alert("Invalid credentials");return;}
  const now=new Date();
  if(acc.expires!=="never" && new Date(acc.expires)<now){
    alert("Account expired.");return;
  }
  currentUser=acc;
  document.getElementById("passwordBox").style.display="none";
  document.getElementById("announcementsSection").style.display="block";
  loadAnnouncements();

  // show embedded class apps for any successfully logged-in user
  showEmbeddedClassApps();

  if(acc.isAdmin) showAdminPanel();
}

// show embedded site (with fallback link)
function showEmbeddedClassApps(){
  const embedArea = document.getElementById("embedArea");
  const targetUrl = "https://myappsclasslink.pegle.com";
  embedArea.innerHTML = `
    <div class="embedHeader">
      <h3 style="margin:0;color:#002F6C">Class Apps</h3>
      <div style="font-size:13px">
        <a href="${targetUrl}" target="_blank" rel="noopener noreferrer" style="color:#002F6C;text-decoration:underline">Open in new tab</a>
      </div>
    </div>
    <div class="embedWrap">
      <iframe src="${targetUrl}" title="Class Apps (myappsclasslink)" sandbox="allow-forms allow-scripts allow-same-origin allow-popups allow-popups-to-escape-sandbox" loading="lazy"></iframe>
      <div class="fallback">If the site doesn't appear above, click "Open in new tab" to access it directly.</div>
    </div>
  `;
  embedArea.style.display = "block";
}

// announcements
async function loadAnnouncements(){
  const list=document.getElementById("announcementsList");
  try{
    const res=await fetch("https://docs.google.com/spreadsheets/d/e/2PACX-1vQ_-w-DAPezbAzU8xZOylF9OnrPxen42KrzJ6MayaRzHxCcj8i6TjVDGfkqidkb2ouMxnit-ocEay61/pub?output=csv");
    const text=await res.text();
    const lines=text.trim().split("\n").slice(1);
    list.innerHTML="";
    lines.forEach(l=>{
      const [t,m]=l.split(",");
      const li=document.createElement("li");
      li.innerHTML=`<strong>${t}</strong>: ${m}`;
      list.appendChild(li);
    });
  }catch(e){
    list.innerHTML="<li>Failed to load announcements</li>";
  }
}
setInterval(loadAnnouncements,60000);

// admin panel
function showAdminPanel(){
  const panel=document.getElementById("adminPanel");
  panel.innerHTML="<h3 style='margin-bottom:8px;color:#002F6C'>Admin Console</h3>";
  panel.style.display="block";
  validUsers.forEach(acc=>{
    const el=document.createElement("div");
    el.className="acct";
    const meta=document.createElement("div");
    meta.innerHTML=`<strong>${acc.username}</strong> <span class='badge ${acc.role.toLowerCase()}'>${acc.role}</span>`;
    const btn=document.createElement("button");
    btn.className="revealBtn";btn.textContent="View";
    btn.onclick=()=>{
      const existing=el.querySelector(".revealBox");
      if(existing){existing.remove();return;}
      const box=document.createElement("div");
      box.className="revealBox";
      box.style="margin-top:8px;padding:8px;border:1px solid #dde9fb;border-radius:6px";
      box.innerHTML=`
        <div>Username: <strong>${acc.username}</strong></div>
        <div>Password: <strong>${acc.password}</strong></div>
        <div>Expires: ${acc.expires}</div>
        <div>Role: ${acc.role}</div>
        <div>Notes: ${acc.notes}</div>`;
      el.appendChild(box);
    };
    el.appendChild(meta);
    el.appendChild(btn);
    panel.appendChild(el);
  });
}

// command bar
const cmdOverlay=document.getElementById("cmdOverlay");
const cmdInput=document.getElementById("cmdInput");
const cmdSubmit=document.getElementById("cmdSubmit");

function toggleCmdBar(force){
  if(!currentUser||!currentUser.isAdmin){
    createNotification("Access Denied","Admins only");
    return;
  }
  const shown=cmdOverlay.style.display==="flex";
  const show=typeof force==="boolean"?force:!shown;
  cmdOverlay.style.display=show?"flex":"none";
  if(show){cmdInput.focus();cmdInput.select();}
}

document.addEventListener("keydown",e=>{
  if(e.key==="'"){e.preventDefault();toggleCmdBar();}
});
cmdSubmit.onclick=()=>runCommand(cmdInput.value.trim());
cmdInput.addEventListener("keydown",e=>{
  if(e.key==="Enter")runCommand(cmdInput.value.trim());
});

async function runCommand(raw){
  if(!raw)return;
  const [cmd,...args]=raw.split(/\s+/);
  switch(cmd.toLowerCase()){
    case"help":
      createNotification("Commands","help ‚Ä¢ gitstats ‚Ä¢ viewinfo [username] ‚Ä¢ reload ‚Ä¢ clear");
      break;
    case"gitstats":
      createNotification("GitHub","Fetching...");
      try{
        const r=await fetch("https://api.github.com/repos/hm9m/letstesteeeschool");
        const j=await r.json();
        createNotification("GitHub Stats",`‚≠ê ${j.stargazers_count} ‚Ä¢ üç¥ ${j.forks_count} ‚Ä¢ üêõ ${j.open_issues_count}`);
      }catch(e){createNotification("GitHub Error",e.message);}
      break;
    case"viewinfo":
      if(!args[0]){createNotification("Usage","viewinfo [username]");break;}
      const user=validUsers.find(u=>u.username===args[0]);
      if(!user){createNotification("Not found",args[0]);break;}
      createNotification("User Info",
        `üë§ ${user.username}<br>üîë ${user.password}<br>üé≠ ${user.role}<br>‚è∞ ${user.expires}<br>üìù ${user.notes}`,{sticky:true});
      break;
    case"reload":
      location.reload();
      break;
    case"clear":
      document.querySelectorAll(".notif").forEach(e=>e.remove());
      updateClearBtn();
      break;
    default:
      createNotification("Unknown Command",cmd);
  }
}
</script>
</body>
</html>
